<html>
  <head>
    <style type="text/css">
      body {
        margin: 40px;
        font-family: helvetica, sans-serif}
      a {
        display: inline-block;
        width: 25%;
        background: #333;
        color: #fff;
        text-align: center;
        text-decoration: none;
        margin: 5px 5px 20px 0;
        font-size: 3rem;
        }
      a:hover {
        background: #666;
      }
    </style>
    <script src="p5.min.js"></script>
    <!-- NOT WORKING.... (at least, not when running locally off the filesystem) -->
    <!--script src="p5.svg.js"></script-->
    <script language="javascript">

    var w = 0;
    margin = 40; //match document margin

    function setup() {
      //createCanvas(window.innerWidth-margin*2, window.innerHeight-margin*2,SVG);
      //createCanvas(window.innerWidth-margin*2, window.innerHeight-margin*2);
      //square on mobile
      //createCanvas(window.innerWidth-margin*2, window.innerWidth-margin*2,SVG);
      createCanvas(window.innerWidth-margin*2, window.innerWidth-margin*2);
    }

    function grid(margin,w,h) {
      noFill();
      strokeWeight(0.5);
      stroke("#000");
      cols = 400;
      rows = 400;
      x = y = margin;

      for(row = 0; row < rows; row++){
        for (col=0; col < cols; col++) {
            rect(x,y,w,h);
            x = (width * -2) + margin + (col * (w + margin))
            y = (height * -2) + margin + (row * (h + margin)) + (h/2 * (col % 2));
        }
      }
    }

    function poly_line_mountain() {
      //noFill();
      noStroke()
      shade = 250
      smoothness = height*Math.random();
      xSteps = width * Math.random();
      thickness(0.2)
      how_many = 15;
      first_y = y = height * rando(0.4, 0.6);
      for(i = 0; i < how_many; i ++) {
        x = 0;
        beginShape();
        while(x < width) {
          vertex(x,y);
          x += rando(width/xSteps,width/xSteps);
          y += rando(-height/smoothness, height/smoothness);
        }
        vertex(width,y);
        vertex(width,height);
        vertex(0,height);
        vertex(0,first_y);
        endShape();
        fill(shade, shade, shade);
        shade *= 1-(i/how_many);
        y += rando(height/200,height/100);

      }
    }
    function thickness(t) {
      strokeWeight(t);
    }

    function mountain() {
      x = 0;//rando(0, width/800);
      y = height * rando(0.4, 0.6);
      //space = width/900; //width/rando(300,800);
      thickness = 1;
      //thickness = rando(0.025,0.05);
      space = thickness;
      strokeWeight(thickness);
      shade = 240;
      flatness = rando(40,700); //higher is less craggy
      dy = rando(-height/flatness, height/flatness);
      resolution = rando(0.3, 0.9);

      while( y < height) {
        stroke(shade, shade, shade);
        line(x,y,x,height);
        y += dy
        if(Math.random()> resolution){
          dy = rando(-height/flatness, height/flatness);
        }
        x += space //rando(space*0.9, space*1.1);
        if(x >= width) {
          resolution = rando(0.3, 0.6);
          //flatness = rando(100,900); //higher is less craggy
          shade *= 0.7
          //x = 0;
          x = 0//rando(0, width/800);
          y += rando(height/50, height/15); //rando(height/50, height/20);
          //thickness *= 1.3;
          strokeWeight(thickness);
          debug(y);
          debug(height);
        }
      }
    }


    function debug(msg) {
      console.log(msg);
    }

    function pattern() {
      clear();
      turns = 3;
      margin = width/(50+(Math.random()*150));
      w = margin * Math.random()*4;
      h = w * Math.random()*4;

      for(i = 0 ; i < turns; i ++ ) {
        rotate(PI/turns);
        translate(width/-5,height/-2)
        grid(margin,w,h);
      }

    }

    function hydro_vents() {
      //stroke(rando(0,255),rando(0,255),rando(0,255));
      //stars();
      for(j = 0; j < 3; j++) {
        fuzzyChain();
      }
    }


    function fuzzyChain () {
        //x1 = rando(0,)
        //walk the chain, use the previous radius + new radius
        x = rando(0,width);
        y = height;
        max_rad = width/200;
        min_rad = max_rad / 2;
        max_fuzz = 0.08;
        i = 0;
        rad = rando(min_rad, max_rad);
        while(y > 0 && i < 50000) {
            thickness = 0.025;
            turns = rando(10,5000);
            fuzziness = rando(max_fuzz * 0.1, max_fuzz)
            star(x,y,rad,thickness, turns, fuzziness);
            angle = (2*Math.PI) + rando(-Math.PI*0.8, Math.PI*0.8);
            old_rad = rad;
            rad = rando(min_rad, max_rad);
            max_rad *= 1.008;
            max_fuzz *= 1.006;
            distance = (rad + old_rad);
            /*old_x = x;
            old_y = y;
            line(old_x, old_y, x,y);*/
            x -= sin(angle) * distance;
            y -= cos(angle) * distance;
            //console.log(y);
            console.log(sin(angle) * (rad + old_rad));
            //rad = new_rad;
            i++;
        }
    }

    function stars() {
      how_many = rando(2,55);

      //fuzziness = rando(0,0.5);

      for(i = 0; i < how_many; i++){
        radius = width/rando(0.25,20);
        turns = rando(10,5000);
        thickness = rando(0.025,0.05);
        //per circle fuzziness
        fuzziness = rando(0.05,0.8);

        star(rando(0,width),rando(0,height),radius,thickness,turns, fuzziness);
        //console.log (rando(0,5));
      }
    }

    function rando(min,max) {
      return (min + (Math.random()*(max-min)))
    }


    function star(x,y,radius,thickness,lines, fuzziness) {
      strokeWeight(thickness);
      //stroke("#fff");
      turns = lines;
      //stroke(rando(0,255),rando(0,255),rando(0,255));
      //stroke(rando(0,50),rando(0,80),rando(30,150));


      for(var i = 0 ; i < turns; i ++ ) {
        push()
        translate(x,y);
        rotate((i * 2*PI/turns) * rando(0.99999,1.00001));
        wiggle_rad = radius * rando(1-fuzziness,1+fuzziness);
        line(-wiggle_rad,-wiggle_rad,wiggle_rad,wiggle_rad);
        pop()
      }
    }

    function mousePressed() {
      main();
    }

    function randomInvert(){
      if(Math.random() < 0.5) {
        background_color = "#fff";
        foreground_color= "#000";
      }else{
        background_color = "#000";
        foreground_color = "#fff";
      }
    }

    function setColors() {
      background(background_color);
      stroke(foreground_color);
      fill(foreground_color);
    }

    function haystack() {
      //randomInvert();
      margin = width/20
      x = margin
      startY = height/2;
      how_many = rando(150,1000);
      ball_size = height/rando(20,200);
      thickness(rando(width/10000,width/200));

      for(i = 0; i < how_many; i++) {
        x = rando(margin, width-margin);
        y = startY * rando(0.05,1.02);
        angle = Math.PI / 2* rando(0.9, 1.1);

        x2 = rando(margin, width-margin);
        y2 = rando(startY, height-margin);

        line(x,y, x2, y2);
        if(Math.random() > 0.5) {
          color = background_color
        }else{
          color = foreground_color
        }
        fill(color)
        ellipse(x,y,ball_size);
        ellipse(x2,y2, ball_size);
        //stroke("#000");
      }
    }

    function cloud(x,y, rad) {
      how_many = rando(4,200);
      c = "#fff";
      if(foreground_color === "#000") {
        c = color(0,0,0,10);
      }else{
        c = color(255,255,255,10);
      }
      //c = color(255,255,255,10);
      for(i = 0; i < how_many; i++) {
        noFill();
        //fill(c);
        noStroke();
        stroke(c);
        rad *= 1.01
        x *= rando(0.99,1.01);
        y *= rando(0.99,1.01);
        ellipse(x,y, rad);
      }
    }

    function clouds() {
      //console.log(foreground_color);
      //c = color(255,255,255,10);
      how_many  = rando(5,500);
      x = width/2; //rando(margin, width-margin);
      y = height/2; //rando(margin, height-margin);

      for(j = 0; j < how_many; j++){
        x *= rando(0.9,1.1);
        y *= rando(0.9,1.1);
        rad = rando(height/30, height/8);
        cloud(x,y,rad);
      }
    }

    function main() {
      setup();
      clear();
      randomInvert();
      /*foreground_color= "#fff";
      background_color = "#000";*/
      setColors();
      //mountain();
      //poly_line_mountain();
      //haystack();
      clouds();
    }
    </script>
  </head>
  <body onload="main()" onresize="main()">
  <!--  <a href="javascript: pattern()">Pattern</a>
    <a href="javascript: main()">X</a>-->
    <!--<a href="javascript: save()">Save</a-->
  </body>
</html>
